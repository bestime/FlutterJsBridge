{"version":3,"file":"index.js","sources":["../../src/libs/event-bus.ts","../../src/main.ts"],"sourcesContent":["// @ts-nocheck\n\n// 获取数据类型\nfunction getType (data) {\n  return Object.prototype.toString.call(data).split(' ')[1].slice(0, -1)\n}\n\nfunction Bus () {\n  this.events = {}; // 事件存放中心\n  this.autoId = 0; // 自动生成的 id\n}\n\n// 基础注册函数\nBus.prototype.create = function (customeid, name, handle, isOnce, onlyOne, type) {\n  if(getType(handle) !== 'Function') return null;\n  var useId = customeid ? customeid : this.autoId++\n  var oneHandle = {      \n    name: name,\n    id: useId,\n    handle: handle,\n    isOnce: isOnce===true ? true : false,\n    type: type\n  };\n\n  if(onlyOne) {\n    this.events[name] = oneHandle\n  } else {\n    getType(this.events[name]) !== 'Array' && (this.events[name] = []);\n    var isFind = false\n    for(var a = 0; a< this.events[name].length; a++) {\n      if(this.events[name][a].id === useId) {\n        this.events[name][a] = oneHandle\n        isFind = true\n        break;\n      }\n    }\n    !isFind && this.events[name].push(oneHandle)\n  }    \n  return oneHandle\n}\n\n// 事件触发\nBus.prototype.emit = function (name) {   \n  var data = []\n  for(var a = 1, len = arguments.length; a < len; a++) {\n    data.push(arguments[a])\n  }\n  switch (getType(this.events[name])) {\n    case 'Object':\n      if(\n        !this.events[name].type\n        || this.events[name].type === data[0]\n      ) {\n        this.events[name].handle.apply(this.events[name], data)\n        if(this.events[name].isOnce) {\n          delete this.events[name]\n        }\n        break;\n      }\n      \n    case 'Array':\n      for(var a=this.events[name].length-1; a>=0; a--) {\n        var item = this.events[name][a]\n        item.handle.apply(item, data)\n        if(\n          !item.type\n          || data[0] === item.type\n        ) {\n          if(item.isOnce) {\n            this.events[name].splice(a, 1)\n          }\n        }\n      }\n      break;\n  }\n}\n\n// 清空整个 bus\nBus.prototype.clearAll = function () {\n  this.events = {}\n  this.autoId = 0\n}\n\n// 清空一个 bus 实例\nBus.prototype.clear = function (opt) {\n  if(getType(opt) !== 'Object') return;\n  switch (getType(this.events[opt.name])) {\n    case 'Object':\n      delete this.events[opt.name]\n      break;\n    case 'Array':\n      for(var a = this.events[opt.name].length-1; a>=0; a--) {\n        if(this.events[opt.name][a].id===opt.id) {\n          this.events[opt.name].splice(a, 1)\n        }\n      }\n      break;\n  }\n}\n\n\n\n// 【注册】 永久函数\nBus.prototype.on = function (name, handle, id) {\n  return this.create(id, name, handle)    \n}\n\n// 【注册】 一次性函数\nBus.prototype.once = function (name, handle, id) {\n  return this.create(id, name, handle, true)\n}\n\n// 【注册】 永久唯一函数\nBus.prototype.one = function (name, handle) {\n  return this.create(null, name, handle, false, true)\n}\n\n// 【注册】 一次性唯一函数\nBus.prototype.oneonce = function (name, handle) {    \n  return this.create(null, name, handle, true, true)\n}\n\nexport default Bus","import CreateEventBus from './libs/event-bus'\n\nexport default class FlutterJsBridge {\n  protected _listen: string\n  protected _send: string\n  protected _count = 0\n  protected _bus = new (CreateEventBus as any)()\n\n  constructor (options: FlutterJsBridge.Setting) {\n    this._listen = options.onAppMessage\n    this._send = options.sendMessage\n\n    this.initListen()\n\n       \n  }\n\n  protected initListen () {\n    (window as any)[this._listen] = (message: string) => {\n      let res: FlutterJsBridge.Message | undefined;\n      try {\n        res = JSON.parse(message)\n      } catch(err){\n        res = undefined\n      }\n      res = res || {\n        id: 'response message error',\n        message\n      }\n\n      this.emit(res)\n    }\n  }\n\n  emit (data: FlutterJsBridge.Message) {\n    this._bus.emit(data.id, data)\n  }\n  \n  on (eventId: string, handle: (data: FlutterJsBridge.Message) => void) {\n    this._bus.on(eventId, handle)\n  }\n\n  send (message: string) {\n    var sendToApp = (window as any)[this._send]\n    return new Promise((resolve, reject) => {\n      if(!sendToApp) {\n        reject('app未提供与web通信的 \"'+ this._send + '\" 方法')\n        return;\n      }\n  \n      this._count++\n      const messageId = 'auto-id-' + this._count\n  \n      const msg:FlutterJsBridge.Message = {\n        id: messageId,\n        message\n      }\n\n      this._bus.once(messageId, function (data: FlutterJsBridge.Message) {\n        resolve(data)\n      })\n      \n      sendToApp.postMessage(JSON.stringify(msg));\n    })\n  }\n}"],"names":["CreateEventBus"],"mappings":"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"}